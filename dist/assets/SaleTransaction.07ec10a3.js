import{Q as V,a as N,b as q,c as A}from"./QDialog.8952d360.js";import{Q as D,H as R,G as T}from"./ClosePopup.56ffc66c.js";import{_ as k,o as n,c as a,W as U,r as M,a as t,w as r,v as y,a4 as f,a3 as v,a5 as _,t as c,b as P,i as x,j as m,X as b,k as F}from"./index.03d082ff.js";import{h as w}from"./moment.9709ab41.js";import{_ as Q}from"./Constants.509ac60c.js";import{_ as Y}from"./category.f4509476.js";import{_ as I}from"./patient.983a6a8f.js";import{_ as E}from"./logo.eab0ac46.js";import"./create.f591e07d.js";const O={props:["item","index"],data(){return{checkedcategories:[]}},methods:{getvial(s){this.$parent.categoryvial.map(l=>{l.id==this.item.id&&(l.vial=1)}),console.log(this.$parent.categoryvial),console.log("checked:"+s.target.checked),console.log("Index:"+this.$parent.selectedvial.indexOf(this.item));let e=this.$parent.selectedvial.indexOf(this.item);s.target.checked?(this.$parent.selectedvial.push(this.item),console.log("selected vial :"+JSON.stringify(this.$parent.selectedvial))):(this.$parent.selectedvial.splice(e,1),console.log("selected vial :"+JSON.stringify(this.$parent.selectedvial)))}}},B=["value","id"];function W(s,e,l,p,o,d){return n(),a("input",{type:"checkbox",value:l.item.id,id:l.item.id,onInput:e[0]||(e[0]=u=>d.getvial(u))},null,40,B)}const z=k(O,[["render",W]]),G={mixins:[Q],data(){return{moment:w,transactiondate:w().format("YYYY-MM-DD"),customermodal:!1,patients:[],addpatientmodal:!1,patientid:"",cartitem:[],products:[],parentid:0,productid:0,quantity:0,sp:0,unit:0,selectedproduct:[],name:"",mobile:"",amount:0,id:0,totalquantity:0,totalvial:0,totalamount:0,selectedvial:[],taxpercent:0,totaltax:0,categoryvial:[{id:1,concentration:0,vial:0},{id:2,concentration:0,vial:0},{id:3,concentration:0,vial:0},{id:4,concentration:0,vial:0},{id:5,concentration:0,vial:0},{id:6,concentration:0,vial:0},{id:7,concentration:0,vial:0},{id:8,concentration:0,vial:0},{id:9,concentration:0,vial:0},{id:10,concentration:0,vial:0}]}},mounted(){this.refresh()},computed:{...U(["loggedinuser","categories","amountwithtax"])},methods:{refresh(){this.transactiondate=w().format("YYYY-MM-DD"),this.$store.dispatch("fetchcategories"),this.$store.dispatch("getloggedinuser");let s={ispatient:1,doctorid:this.loggedinuser.id};axios.post("api/user/fetch/by/query",s).then(e=>this.customerResponse(e.data)).catch(e=>this.errorResponse(e))},customerResponse(s){this.patients=s.user},errorResponse(){alert("Something Went Wrong")},getproducts(){let s={category_id:this.parentid};axios.post("api/products/fetch/bycategory",s).then(e=>this.productresponse(e.data)).catch(e=>this.errorResponse(e))},productresponse(s){this.products=s},updatevalue(){if(this.products!=null){let s=this.products.find(e=>e.id===this.productid);this.selectedproduct=s,s!=null&&(this.sp=s.sp,this.unit=s.unit)}},getvial(s){this.selectedvial.length>0?this.selectedvial.find(l=>l.id==s.id)?this.selectedvial.map(l=>{l.id==s.id&&(l.concentration=s.concentration)}):alert("First Check the box then select"):(alert("First Check the box then select"),s.concentration=0)},initialize(){this.selectedproduct=[],this.quantity=0,this.sp=0,this.unit=0,this.productid=0,this.parentid=0,this.name="",this.mobile="",this.cartitem=[],this.products=[],this.selectedvial=[],this.amount=0,this.patientid=0,this.categoryvial=[{id:1,concentration:0,vial:0},{id:2,concentration:0,vial:0},{id:3,concentration:0,vial:0},{id:4,concentration:0,vial:0},{id:5,concentration:0,vial:0},{id:6,concentration:0,vial:0},{id:7,concentration:0,vial:0},{id:8,concentration:0,vial:0},{id:9,concentration:0,vial:0},{id:10,concentration:0,vial:0}]},updatecartitems(){if(this.productid!=0){let s={categoryid:this.parentid,productid:this.productid,product:this.selectedproduct,quantity:this.quantity,price:this.sp,unit:this.unit};this.cartitem.push(s),this.selectedproduct=[],this.quantity=0,this.sp=0,this.unit=0,this.productid=0,this.parentid=0}},deletecartitem(s){this.cartitem.splice(s,1)},setquantity(){let s=0;return this.cartitem.length>0&&this.cartitem.forEach(e=>{s=parseFloat(s)+parseFloat(e.quantity)}),s},submitcustomer(){if(this.mobile=="")alert("Mobile is compulsory");else{let s={ispatient:1,name:this.name,mobile:this.mobile,doctorid:this.loggedinuser.id};axios.post("api/profile/createupdate",s).then(e=>this.processResponsePAtient(e.data)).catch(e=>this.fetcherror(e))}},processResponsePAtient(){alert("Submitted Successfully"),this.addpatientmodal=!1,this.initialize(),this.refresh()},fetcherror(){alert("Something went Wrong")},getamount(){var s;if(this.cartitem.length>0){let e=(s=this.cartitem[0])==null?void 0:s.categoryid,l=this.getcategoryname(e);console.log("category price :"+l.price);let p=0;this.selectedvial.length>0&&this.selectedvial.forEach(u=>{p=p+parseInt(u.vial)}),this.totalvial=p,console.log("total vial :"+this.totalvial),this.amount=parseInt(this.totalvial)*parseFloat(l.price),console.log("Before Amount: "+this.amount);let o=this.getmastertype(this.MASTER_TAX);o.length>0&&o.forEach(u=>{u.labelid==3&&(console.log("IGST:"+u.value),this.taxpercent=parseInt(u.value))}),this.totaltax=parseFloat(this.amount)*this.taxpercent/100,console.log("total tax:"+this.totaltax);let d=this.amount+parseFloat(this.totaltax);this.$store.commit("assignamountwithtax",d),console.log("total Final amount:"+this.amountwithtax)}},submittransaction(){if(this.selectedvial.length>0&&this.cartitem.length>0){let s={id:this.id,amount:this.amount,amountwithtax:this.amountwithtax,items:this.cartitem,transactiondate:this.transactiondate,patientid:this.patientid,doctorid:this.loggedinuser.id,selectedvial:this.selectedvial,totalvial:this.totalvial,taxes:this.totaltax,taxpercent:this.taxpercent};confirm("Do you want to Submit Sale")&&axios.post("api/submittransaction",s).then(e=>this.processResponsetransaction(e.data)).catch(e=>this.fetcherror(e))}else alert("Add cart and vial to submit")},processResponsetransaction(){alert("Your data Has been saved successfully"),this.initialize(),this.refresh()},getcategoryname(s){var l;return(l=this.categories)==null?void 0:l.find(p=>p.id==s)},getpatientdetail(s){let e="";return this.patients!=null&&(e=this.patients.find(l=>l.id==s)),e}},components:{CheckedVial:z}},H=F('<div class="headline mb-20"><div class="title flex-row-centered"><img src="'+Y+'" class="img" width="20" height="20"><div class="title-span">Add New Sale</div></div><div class="flex-row-centered"></div></div>',1),J={class:"boxshow"},X={class:"col-md-12"},j={class:"col-md-6 p-0"},L=t("div",{class:"col-md-3 p-0"},[t("label",{class:"width-30"},"Date :")],-1),K={class:"col-md-7 p-0"},Z={class:"col-md-12 flex-between-row gap-20 mt-20"},$={class:"col-md-6 p-0"},tt=t("div",{class:"col-md-3 p-0"},[t("label",{class:"width-30"},"Patient Name :")],-1),et={class:"col-md-7 p-0"},it=t("option",{value:"0"},"Select",-1),st=["value"],ot=x("+ "),lt=t("img",{src:I,width:"20",height:"20"},null,-1),nt=[ot,lt],at=t("div",{class:"col-md-3 p-0 pt-10"},[t("label",{class:"width-30"},"Patient Mobile No. :")],-1),dt={class:"col-md-7 p-0 pt-10"},ct=["value"],rt={class:"col-md-6 p-0"},ut=t("div",{class:"col-md-4 p-0"},[t("label",{for:""},"Physician Name Dr:")],-1),ht={class:"col-md-6 p-0"},pt=["value"],mt=t("hr",{style:{width:"100%",border:"1px solid #bbbbd0"}},null,-1),vt={class:"table-responsive"},_t={class:"table",style:{"text-align":"center"}},gt=t("thead",null,[t("tr",null,[t("th",null,"S.No"),t("th",null,"Category Name"),t("th",null,"Product Name"),t("th",null,"Quantity(ml)"),t("th",null,"Unit"),t("th",null,"Delete")])],-1),ft=["onClick"],bt=t("i",{class:"bx bx-trash"},null,-1),yt=[bt],xt=t("td",null,null,-1),wt=t("option",{value:"0"},"Select",-1),Ct=["value"],St=t("option",{value:"0"},"Select",-1),kt=["value"],Vt=t("option",{value:"0"},"Select",-1),Nt=t("option",{value:"1"},"vial",-1),qt=t("option",{value:"2"},"ml",-1),At=[Vt,Nt,qt],Dt=t("td",null,null,-1),Rt=t("td",null,null,-1),Tt=t("td",null,null,-1),Ut=t("td",null,null,-1),Mt=t("td",null,null,-1),Pt=t("hr",{style:{width:"100%",border:"1px solid #bbbbd0"}},null,-1),Ft={class:"col-md-4"},Qt={class:"table-responsive"},Yt={class:"table",style:{"text-align":"center"}},It=t("thead",null,[t("tr",null,[t("th",null,"Vial"),t("th",null,"Concentration")])],-1),Et=["onChange","onUpdate:modelValue"],Ot=["value"],Bt={class:"col-md-6 text-right"},Wt=t("label",{for:""},"Total Vial :",-1),zt={class:"col-md-12 mt-10 mb-30 text-center"},Gt=x("Submit Sale "),Ht=t("i",{class:"bx bx-send"},null,-1),Jt=[Gt,Ht],Xt={class:"pl-20 pr-20 pt-10 flex-between-row align-items-center"},jt=t("img",{src:E,width:"100"},null,-1),Lt=t("span",{class:"text-weight-bold"},"Add Patient Details",-1),Kt={class:"col-md-12"},Zt=t("div",{class:"col-md-4 mt-20"},[t("label",{for:"Search Customer"},"Patient Name")],-1),$t={class:"col-md-8 mt-20"},te=t("div",{class:"col-md-4 mt-20"},[t("label",{for:"Search Customer"},"Patient Mobile No.")],-1),ee={class:"col-md-8 mt-20"},ie={class:"col-md-12 text-center mb-20 mt-20"};function se(s,e,l,p,o,d){var C,S;const u=M("CheckedVial");return n(),a("div",null,[H,t("div",J,[t("div",X,[t("div",j,[L,t("div",K,[r(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=i=>o.transactiondate=i),class:"form-control"},null,512),[[y,o.transactiondate]])])])]),t("div",Z,[t("div",$,[tt,t("div",et,[r(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>o.patientid=i),class:"form-control"},[it,(n(!0),a(v,null,_(o.patients,i=>(n(),a("option",{key:i.id,value:i.id},c(i.name),9,st))),128))],512),[[f,o.patientid]]),o.parentid==0?(n(),a("button",{key:0,class:"btn btn-primary patient",onClick:e[2]||(e[2]=i=>o.addpatientmodal=!0)},nt)):P("",!0)]),at,t("div",dt,[t("input",{type:"number",value:(C=d.getpatientdetail(o.patientid))==null?void 0:C.mobile,class:"form-control",readonly:""},null,8,ct)])]),t("div",rt,[ut,t("div",ht,[t("input",{type:"text",value:(S=s.loggedinuser)==null?void 0:S.name,readonly:"",class:"form-control"},null,8,pt)])])]),mt,t("div",vt,[t("table",_t,[gt,t("tbody",null,[(n(!0),a(v,null,_(o.cartitem,(i,g)=>{var h;return n(),a("tr",{key:i.id},[t("td",null,c(g+1),1),t("td",null,c((h=i.product.category)==null?void 0:h.name),1),t("td",null,c(i.product.name),1),t("td",null,c(i.quantity),1),t("td",null,c(i.product.unit),1),t("td",null,[t("button",{class:"btn btn-danger",onClick:oe=>d.deletecartitem(g)},yt,8,ft)])])}),128)),t("tr",null,[xt,t("td",null,[r(t("select",{name:"",id:"",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=i=>o.parentid=i),onChange:e[4]||(e[4]=i=>d.getproducts())},[wt,(n(!0),a(v,null,_(s.categories,i=>(n(),a("option",{key:i.id,value:i.id},c(i.name),9,Ct))),128))],544),[[f,o.parentid]])]),t("td",null,[r(t("select",{name:"",id:"",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=i=>o.productid=i),onChange:e[6]||(e[6]=i=>d.updatevalue())},[St,(n(!0),a(v,null,_(o.products,i=>(n(),a("option",{key:i.id,value:i.id},c(i.name),9,kt))),128))],544),[[f,o.productid]])]),t("td",null,[r(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=i=>o.quantity=i),class:"form-control"},null,512),[[y,o.quantity]])]),t("td",null,[r(t("select",{name:"",id:"","onUpdate:modelValue":e[8]||(e[8]=i=>o.unit=i),class:"form-control"},At,512),[[f,o.unit]])]),Dt]),t("tr",null,[Rt,Tt,Ut,t("td",null,[t("b",null,c(d.setquantity()),1)]),t("td",null,[t("b",null,c(d.getamount()),1)]),Mt])]),t("button",{class:"btn btn-primary mt-20",onClick:e[9]||(e[9]=i=>d.updatecartitems())},"Add Item")])]),Pt,t("div",Ft,[t("div",Qt,[t("table",Yt,[It,t("tbody",null,[(n(!0),a(v,null,_(o.categoryvial,(i,g)=>(n(),a("tr",{key:i.id},[t("td",null,[x(c(g+1)+". ",1),m(u,{item:i,index:g},null,8,["item","index"])]),t("td",null,[r(t("select",{name:"",id:"",onChange:h=>d.getvial(i),"onUpdate:modelValue":h=>i.concentration=h,class:"form-control"},[(n(!0),a(v,null,_(s.getmastertype(s.MASTER_CONCENTRATION),h=>(n(),a("option",{value:h.labelid},c(h.label),9,Ot))),256))],40,Et),[[f,i.concentration]])])]))),128))])]),t("div",Bt,[Wt,x(c(o.totalvial),1)])])])]),t("div",zt,[t("button",{class:"btn btn-primary",onClick:e[10]||(e[10]=i=>d.submittransaction()),style:{width:"20%"}},Jt)]),m(A,{modelValue:o.addpatientmodal,"onUpdate:modelValue":e[14]||(e[14]=i=>o.addpatientmodal=i),width:400},{default:b(()=>[m(V,{style:{width:"600px"}},{default:b(()=>[t("div",Xt,[m(N,null,{default:b(()=>[jt]),_:1}),m(D,null,{default:b(()=>[Lt]),_:1}),r(m(T,{flat:"",round:"",dense:"",icon:"close"},null,512),[[R]])]),m(q,null,{default:b(()=>[t("div",Kt,[Zt,t("div",$t,[r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[11]||(e[11]=i=>o.name=i)},null,512),[[y,o.name]])]),te,t("div",ee,[r(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[12]||(e[12]=i=>o.mobile=i)},null,512),[[y,o.mobile]])])])]),_:1}),t("div",ie,[t("button",{type:"button",class:"btn btn-success",onClick:e[13]||(e[13]=i=>d.submitcustomer())},"Submit")])]),_:1})]),_:1},8,["modelValue"])])}const me=k(G,[["render",se]]);export{me as default};
